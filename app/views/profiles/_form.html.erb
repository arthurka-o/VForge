<%= form_with(model: @profile, url: profile_path, data: { controller: "auto-submit" } ) do |form| %>
  <div>
    <div class=" bg-slate-200 rounded-2xl shadow overflow-hidden mx-auto">
      <% if @profile.avatar.attached? %>
        <div class="p-1 pb-0">
          <image class="rounded-2xl object-cover w-full h-full" src="<%= url_for(@profile.avatar) %>">
        </div>
      <% end %>

      
      <div class="p-6 pt-0">
        <%= form.text_field :username, class: 'shadow appearance-none border rounded w-full mt-2 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline', data: { auto_submit_target: "field", action: "input->auto-submit#update" } %>

        <%= form.fields_for :traits, @profile.traits.find_or_initialize_by(category: :prompt, name: :bio) do |trait_form| %> <%# it works good if only bio is created beforehand. If not, it creates a trait without a name or category %>
          <%= trait_form.text_area :value, class: 'shadow appearance-none border rounded w-full mt-2 py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline', data: { auto_submit_target: "field", action: "input->auto-submit#update" } %>
        <% end %>
        
        <div class="pt-3">
          <p class="text-3x1 text-gray-500">Interests</p>
          <%= turbo_stream_from 'traits' %>
          <div id="traits">
            <% @profile.traits.interest.each do |trait| %>
              <%= render partial: trait, locals: { edit: true } %>
            <% end %>
          </div>
          <br>
          <br>
          <%= turbo_frame_tag 'add_new_trait' do %>
            <%= link_to new_trait_path do %>
              <%= content_tag :div, class: %w[btn-trait bg-green-300] do %>
                âž• Add New
              <% end %>
            <% end %>
          <% end %>
        </div>

        <div class="pt-3">
          <p class="text-3x1 text-gray-500">Basics</p>
          <% @profile.traits.basic.sort_by(&:name).each do |trait| %>
            <%= render partial: trait, locals: { edit: true } %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
<% end %>
